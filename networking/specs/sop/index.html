<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-networking/specs/sop/README" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.1">
<title data-rh="true">SOP: Same Origin Policy | Cybersecurity Handbook</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://herrera-ignacio.github.io/cybersecurity-handbook/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://herrera-ignacio.github.io/cybersecurity-handbook/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://herrera-ignacio.github.io/cybersecurity-handbook/networking/specs/sop/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="SOP: Same Origin Policy | Cybersecurity Handbook"><meta data-rh="true" name="description" content="Under the poliy, a web browser permits scripts contained in a first web page to access data in a second web page, but only if both web pages have the same origin."><meta data-rh="true" property="og:description" content="Under the poliy, a web browser permits scripts contained in a first web page to access data in a second web page, but only if both web pages have the same origin."><link data-rh="true" rel="icon" href="/cybersecurity-handbook/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://herrera-ignacio.github.io/cybersecurity-handbook/networking/specs/sop/"><link data-rh="true" rel="alternate" href="https://herrera-ignacio.github.io/cybersecurity-handbook/networking/specs/sop/" hreflang="en"><link data-rh="true" rel="alternate" href="https://herrera-ignacio.github.io/cybersecurity-handbook/networking/specs/sop/" hreflang="x-default"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/cybersecurity-handbook/assets/css/styles.ebb2964c.css">
<script src="/cybersecurity-handbook/assets/js/runtime~main.479a4c56.js" defer="defer"></script>
<script src="/cybersecurity-handbook/assets/js/main.a0365283.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/cybersecurity-handbook/"><b class="navbar__title text--truncate">Cybersecurity Handbook</b></a></div><div class="navbar__items navbar__items--right"><a href="https://www.linkedin.com/in/ignacioromanherrera/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/herrera-ignacio/cybersecurity-handbook" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/cybersecurity-handbook/">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/cybersecurity-handbook/fundamentals/bug-bounty/">Fundamentals</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/cybersecurity-handbook/networking/concepts/devices/">Networking</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/cybersecurity-handbook/networking/concepts/devices/">Concepts and practices</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/cybersecurity-handbook/networking/attacks/traffic-analysis/">Attacks</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/cybersecurity-handbook/networking/specs/cookies/">Specs</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/cybersecurity-handbook/networking/specs/cookies/">Cookies</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/cybersecurity-handbook/networking/specs/corb/">CORB - Cross-Origin Read Blocking</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/cybersecurity-handbook/networking/specs/cors/">CORS - Cross-Origin Resource Sharing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/cybersecurity-handbook/networking/specs/csp/">CSP - Content Security Policy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/cybersecurity-handbook/networking/specs/dom/">DOM - Document Object Model</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/cybersecurity-handbook/networking/specs/html/">HTML</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/cybersecurity-handbook/networking/specs/http/">HTTP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/cybersecurity-handbook/networking/specs/http-headers/">HTTP Headers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/cybersecurity-handbook/networking/specs/http-requests/">HTTP Requests</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/cybersecurity-handbook/networking/specs/ipaddressing/">IP Addressing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/cybersecurity-handbook/networking/specs/mime-types/">[MIME Types](https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/cybersecurity-handbook/networking/specs/routing-protocols/">Routing Protocols</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/cybersecurity-handbook/networking/specs/sop/">SOP: Same Origin Policy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/cybersecurity-handbook/networking/specs/spf/">SPF: Sender Policy Framewrok</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/cybersecurity-handbook/networking/specs/tcp-ip/">TCP/IP Model</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/cybersecurity-handbook/networking/standards/ieee802/">Standards</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/cybersecurity-handbook/cryptography/concepts/hashing/">Cryptography</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/cybersecurity-handbook/books/hackerplaybook/">Books</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/cybersecurity-handbook/cert_notes/ccna/">Certifications</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/cybersecurity-handbook/lectures/compliance/hipaa-training/">Lectures</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/cybersecurity-handbook/offensive-security/web-proxies/">Offensive security</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/cybersecurity-handbook/os/linux/file_management/">Operating systems</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/cybersecurity-handbook/vulnerabilities/server/shellshock/">Vulnerabilities</a></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/cybersecurity-handbook/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Networking</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Specs</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">SOP: Same Origin Policy</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>SOP: Same Origin Policy</h1>
<p>Under the poliy, a web browser permits scripts contained in a first web page to access data in a second web page, but only if both web pages have the same <em>origin</em>.</p>
<p>This policy prevents a malicious script on one page from obtaining access to sensitive data on another web page through that page&#x27;s DOM.</p>
<p>It&#x27;s very important to remember that SOP <em>applies only to scripts</em>. This means that resource such as images, CSS, and dynamically-loaded scrips can be accessed across origins via the corresponding HTML tags (with fonts being a notable exception).</p>
<p><strong>Attackers take advantage of the fact that SOP does not apply to HTLM tags</strong>.</p>
<ul>
<li><a href="https://www.youtube.com/watch?v=KaEj_qZgiKY" target="_blank" rel="noopener noreferrer">CSRF Introduction and what is SOP</a>.</li>
</ul>
<p>SOP allows simple cross-origin requests (GET/POST/HEAD) with a set of allowed custom headers only:</p>
<ul>
<li>Accept</li>
<li>Accept-Language</li>
<li>Content-Language</li>
<li>Content-Type<!-- -->
<ul>
<li>application/x-www-form-urlencoded</li>
<li>multipart/form-data</li>
<li>text/palin</li>
</ul>
</li>
</ul>
<p>Also, for cross-origin request, by default JavaScript may only access so-called &#x27;simple&#x27; response headers:</p>
<ul>
<li>Cache-Control</li>
<li>Content-Language</li>
<li>Content-Type</li>
<li>Expires</li>
<li>Last-Modified</li>
<li>Pragma</li>
</ul>
<p>Any &#x27;non-simple&#x27; requests, the browser does not make such requests right away. Before, it sends a preliminary, so-called &#x27;preflight&#x27; request <code>OPTIONS</code>, asking for permission (is at this point that CORS gets involved).</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="toc">TOC:<a href="#toc" class="hash-link" aria-label="Direct link to TOC:" title="Direct link to TOC:">​</a></h2>
<ul>
<li>Origin</li>
<li>Details</li>
<li>SOP Implementation</li>
<li>Origin determination rules</li>
<li>Security Application</li>
<li>Relaxing SOP Methods<!-- -->
<ul>
<li>Data tainting</li>
<li><code>document.domain</code> property</li>
<li>CORS: Cross-Origin Resource Sharing</li>
<li>Cross-document messaging</li>
<li>JSONP</li>
<li>WebSockets</li>
</ul>
</li>
<li>Corner Cases</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="origin">Origin<a href="#origin" class="hash-link" aria-label="Direct link to Origin" title="Direct link to Origin">​</a></h2>
<p>An origin is defined as a combination of</p>
<ul>
<li>URI Scheme</li>
<li>Host Name</li>
<li>Port Number</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="details">Details<a href="#details" class="hash-link" aria-label="Direct link to Details" title="Direct link to Details">​</a></h2>
<p>The same-origin policy restricts which network messages one origin can send to another. For example, the same-origin policy allows inter-origin HTTP requests with GET and POST methods but denies inter-origin PUT and DELETE requests.</p>
<p>Additionally, origins can use custom HTTP headers when sending requests to themselves but cannot use custom headers when sending requests to other origins.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="implementation">Implementation<a href="#implementation" class="hash-link" aria-label="Direct link to Implementation" title="Direct link to Implementation">​</a></h2>
<p>Modern browsers implement some form of SOP, but policies are not required to match an exact specifiction, instead they often extend those to define roughly compatible security boundaries for other web technologies, such as Adobe Flash, or for mechanisms other than direct DOM manipulation, such as <em>XMLHttpRequest</em>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="origin-determination-rules">Origin determination rules<a href="#origin-determination-rules" class="hash-link" aria-label="Direct link to Origin determination rules" title="Direct link to Origin determination rules">​</a></h2>
<p>The algorithm used to calculate the &quot;Origin&quot; of a URI is specified in <a href="https://tools.ietf.org/html/rfc6454" target="_blank" rel="noopener noreferrer">RFC 6454</a>.</p>
<p>Check the following examples that vie an overview of typical outcomes for checks against the URL: <code>http://www.example.com/dir/page.html</code>.</p>
<p><img loading="lazy" alt="origin algorithm" src="/cybersecurity-handbook/assets/images/origin-algorithm-f8de104ed623364889a07d4b8227c028.png" width="859" height="277" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="security-applications">Security Applications<a href="#security-applications" class="hash-link" aria-label="Direct link to Security Applications" title="Direct link to Security Applications">​</a></h2>
<p>SOP helps protect sits that uses authenticated sessions.</p>
<p>See the following example:</p>
<p>Assume that a user is visiting a banking website and doesn&#x27;t log out.</p>
<p>Then the user goes to another site that has some malicious Javascript code running in the background that requests data from the banking site.</p>
<p>Because the user is still logged in on the banking site, malicious code could do anything the user could do on the banking site, like get a list of user&#x27;s last transactions, create a new transaction, etc... This is because the browser cand send and receive session cookies to the banking site based on the domain of the banking site.</p>
<p>The user visit the malicious site would except that the site has no access to the banking session cookie. While it is true that the JavaScript has no diret access to the banking session cookie, it could still send and receive requests to the banking site with the banking site&#x27;s session cookie, even CSRF protections by the banking site would not be effective.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="relaxing-sop">Relaxing SOP<a href="#relaxing-sop" class="hash-link" aria-label="Direct link to Relaxing SOP" title="Direct link to Relaxing SOP">​</a></h2>
<p>In some circunstances, SOP is too restrictive, giving problems for large websites that use multiple <em>subdomains</em>. Modern browsers support multiple techniques for relaxing SOP ina controlled manner:</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="data-taining">Data Taining<a href="#data-taining" class="hash-link" aria-label="Direct link to Data Taining" title="Direct link to Data Taining">​</a></h4>
<p>If enabled by a user, it would allow websites to attempt to read JS properties of windows and frames belonging to a different domain. The browser would then ask the user whether to permit the access in question.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="documentdomain"><code>document.domain</code><a href="#documentdomain" class="hash-link" aria-label="Direct link to documentdomain" title="Direct link to documentdomain">​</a></h4>
<p>If two windows/frames contain scripts that set domain to the same value, SOP is relaxed for these two windows and they can interat with te other.</p>
<p>They make their documents appear toh ave the same origni and enabling each documet to read properties of the other.</p>
<p>Settings tis property implicitly sets the port to <code>null</code>, which most browsers will interpret differently from port 80 or even an unspecified port.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="cors">CORS<a href="#cors" class="hash-link" aria-label="Direct link to CORS" title="Direct link to CORS">​</a></h4>
<p>Standarized technique under the name of <em>Cross-Origin Resource Sharing</em>.</p>
<p>This standard extends HTTP with a new <code>Origin</code> request header and a new <code>Access-Control-Allow-Origin</code> response header.</p>
<p>It allows servers to use a header to explicitly list origins that may request a file or to use wildcard and allow a file to be requested by any site.</p>
<p>Firefox, Safari and IE (from specific versions) use this headers to allow the cross-origin HTTP requests with XMLHttpRequest that would otherwise have been forbidden by SOP.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="cross-document-messaging">Cross-Document Messaging<a href="#cross-document-messaging" class="hash-link" aria-label="Direct link to Cross-Document Messaging" title="Direct link to Cross-Document Messaging">​</a></h4>
<p>Allows a script from one page to pass textual messages to a script on another page regardless of the script origins.</p>
<p>A script in one page still cannot diretly access methods or variables in the other page, but they can communicate safely through this message-passing technique.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="jsonp">JSONP<a href="#jsonp" class="hash-link" aria-label="Direct link to JSONP" title="Direct link to JSONP">​</a></h4>
<p>Since HTML <code>&lt;script&gt;</code> elements are allowed to retrieve and execute content from other domains, a page can bypass the SOP and receiv JSON data from a different domain by loading a resoruce that returns a JSONP payload, which consists of an internal JSON payload wrapped by a pre-defined function call.</p>
<p>When the script resource is loaded by the browser, the designated callback function will be invokd to process the wrapped JSON payload.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="websockets">WebSockets<a href="#websockets" class="hash-link" aria-label="Direct link to WebSockets" title="Direct link to WebSockets">​</a></h4>
<p>Modern browsers will permit a script to connect to a WebSocket address without applying SOP. However, they recognize when a WebSocket URI is used and insert an <code>Origin</code> header into the request that indicates the origin of the script requesting the connection.</p>
<p>To ensure cross-site security, the WebSocket server must compare the header data against a whitelsit of origins permited to receive a reploy.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="corner-cases">Corner Cases<a href="#corner-cases" class="hash-link" aria-label="Direct link to Corner Cases" title="Direct link to Corner Cases">​</a></h2>
<p>The behavior of <strong>same-origin-checks</strong> and related mechanisms is not well-defined in a number of corner cases such as pseudo-protocols that do not have a clearly defined host name or port associated with thir URLs (<code>file:</code>, <code>data:</code>, etc...).</p>
<p>This historically caused a fair number of security problems, such as the generally undesirable ability of any locally stored HTML file to access all other files on the disk, or communicate with any site on the Internet.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="attacks-in-face-of-sop">Attacks in face of SOP<a href="#attacks-in-face-of-sop" class="hash-link" aria-label="Direct link to Attacks in face of SOP" title="Direct link to Attacks in face of SOP">​</a></h2>
<p>Even with SOP not being relaxed (by CORS for example) certain cross-origin computer ttacks can be performed.</p>
<p><a href="https://en.wikipedia.org/wiki/WebRTC" target="_blank" rel="noopener noreferrer">WebRTC</a> can be used out the internal IP address of a victim.</p>
<p>If attempting to connect to a cross-origin port, responses cannot be read in face of SOP, but even then, Javascript can still make inferences on whether the port is open or closed by checking if the onload/onerror event fires, or if we get a timeout.</p>
<p>Further, Javascript can even fingerprint servicess cross-origin by taking advange of default files. For example, if a Javascript script loaded from the site <code>evil.com</code> attempts to open the file <code>http://127.0.0.1/images/jenkins.png</code> and the onload event fires, then it can be inferred that the victim runs Jenkins on his own computer. This way the attacker can find potentialy vulnerable ervices for example on the internal network, even in face of the same-origin policy.</p>
<p>Should any service be vulnerable to <em>CSRF</em>, they can even be compromised.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/cybersecurity-handbook/networking/specs/routing-protocols/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Routing Protocols</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/cybersecurity-handbook/networking/specs/spf/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">SPF: Sender Policy Framewrok</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#toc" class="table-of-contents__link toc-highlight">TOC:</a></li><li><a href="#origin" class="table-of-contents__link toc-highlight">Origin</a></li><li><a href="#details" class="table-of-contents__link toc-highlight">Details</a></li><li><a href="#implementation" class="table-of-contents__link toc-highlight">Implementation</a></li><li><a href="#origin-determination-rules" class="table-of-contents__link toc-highlight">Origin determination rules</a></li><li><a href="#security-applications" class="table-of-contents__link toc-highlight">Security Applications</a></li><li><a href="#relaxing-sop" class="table-of-contents__link toc-highlight">Relaxing SOP</a></li><li><a href="#corner-cases" class="table-of-contents__link toc-highlight">Corner Cases</a></li><li><a href="#attacks-in-face-of-sop" class="table-of-contents__link toc-highlight">Attacks in face of SOP</a></li></ul></div></div></div></div></main></div></div></div></div>
</body>
</html>