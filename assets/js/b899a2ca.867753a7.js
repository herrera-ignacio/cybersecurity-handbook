"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[6691],{3485:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>c,default:()=>m,frontMatter:()=>o,metadata:()=>r,toc:()=>l});var a=t(5893),i=t(1151);const o={},c="Command Injection",r={id:"vulnerabilities/web/command-injection/README",title:"Command Injection",description:"Attack in which the goal is execution of arbitrary commands on the host operating system via a vulnerable application.",source:"@site/docs/vulnerabilities/web/command-injection/README.md",sourceDirName:"vulnerabilities/web/command-injection",slug:"/vulnerabilities/web/command-injection/",permalink:"/cybersecurity-handbook/vulnerabilities/web/command-injection/",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Clickjacking",permalink:"/cybersecurity-handbook/vulnerabilities/web/clickjacking/"},next:{title:"Cookie Tampering",permalink:"/cybersecurity-handbook/vulnerabilities/web/cookie-tampering/"}},s={},l=[{value:"Not Code Injection",id:"not-code-injection",level:4},{value:"Example",id:"example",level:2},{value:"Example 1",id:"example-1",level:3},{value:"Example 2",id:"example-2",level:3},{value:"Example 3",id:"example-3",level:3}];function d(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",p:"p",pre:"pre",strong:"strong",...(0,i.a)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.h1,{id:"command-injection",children:"Command Injection"}),"\n",(0,a.jsxs)(n.p,{children:["Attack in which the goal is ",(0,a.jsx)(n.strong,{children:"execution of arbitrary commands on the host operating system via a vulnerable application"}),"."]}),"\n",(0,a.jsx)(n.p,{children:"Command Injection attacks are possible when an application passes unsafe user supplied data (forms, cookies, HTTP headers, etc) to a system shell."}),"\n",(0,a.jsx)(n.p,{children:"Attacker-supplied operating system commands are usualy executed with the privilege of the vulnerable application."}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.a,{href:"https://owasp.org/www-community/attacks/Command_Injection",children:"OWASP: Command Injection"})}),"\n",(0,a.jsx)(n.h4,{id:"not-code-injection",children:"Not Code Injection"}),"\n",(0,a.jsxs)(n.p,{children:["This attack differs from ",(0,a.jsx)(n.em,{children:"Code Injection"}),", in that code injection allows the attacker to add his own code that is then executed by the application."]}),"\n",(0,a.jsx)(n.h2,{id:"example",children:"Example"}),"\n",(0,a.jsx)(n.h3,{id:"example-1",children:"Example 1"}),"\n",(0,a.jsx)(n.p,{children:"The following code prints the content of a file to standard output:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-c",children:'#include <stdio.h>\n#include <unistd.h>\n\nint main(int argc, char **argv) {\n char cat[] = "cat ";\n char *command;\n size_t commandLength;\n\n commandLength = strlen(cat) + strlen(argv[1]) + 1;\n command = (char *) malloc(commandLength);\n strncpy(command, cat, commandLength);\n strncat(command, argv[1], (commandLength - strlen(cat)) );\n\n system(command);\n return (0);\n}\n'})}),"\n",(0,a.jsx)(n.p,{children:"Used normally..."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"$ ./catWrapper Story.txt\nWhen last we left our heroes...\n"})}),"\n",(0,a.jsx)(n.p,{children:"However if we add a semicolon and another command, the command is executed:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:'$ ./catWrapper "Story.txt; ls"\nWhen last we left our heroes...\nStory.txt               doubFree.c              nullpointer.c\nunstosig.c              www*                    a.out*\nformat.c                strlen.c                useFree*\ncatWrapper*             misnull.c               strlength.c             useFree.c\ncommandinjection.c      nodefault.c             trunc.c                 writeWhatWhere.c\n'})}),"\n",(0,a.jsx)(n.h3,{id:"example-2",children:"Example 2"}),"\n",(0,a.jsx)(n.p,{children:"The following code uses the environment variable $APPHOME to execute an initialization script in that directory."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:'       ...\n       char* home=getenv("APPHOME");\n       char* cmd=(char*)malloc(strlen(home)+strlen(INITCMD));\n       if (cmd) {\n               strcpy(cmd,home);\n               strcat(cmd,INITCMD);\n               execl(cmd, NULL);\n       }\n       ...\n'})}),"\n",(0,a.jsx)(n.p,{children:"An attacker can modify the environment variable $APPHOME to specify a different path containing a malicious version of INITCMD."}),"\n",(0,a.jsx)(n.h3,{id:"example-3",children:"Example 3"}),"\n",(0,a.jsxs)(n.p,{children:["The following allows users to change their passwords. The password update process under NIS includes running ",(0,a.jsx)(n.code,{children:"make"})," in the /var/yp directory. Note that since the program updates password records, it has been installed setuid root."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:'system("cd /var/yp && make &> /dev/null");\n'})}),"\n",(0,a.jsxs)(n.p,{children:["Even though this example is hardcoded and an attacker cannot control the argment passed to ",(0,a.jsx)(n.code,{children:"system()"}),", since the program does not specify an absolute path for make, and does not scrub any environment variable prior to invoking the command, the attacker can modify their ",(0,a.jsx)(n.code,{children:"$PATH"})," variable to point to a malicious binary named ",(0,a.jsx)(n.code,{children:"make"})," and execute the CGI script from a shell propt. And since the proram has been installe setuid root, the attacker's version of make now runs with root privileges."]})]})}function m(e={}){const{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},1151:(e,n,t)=>{t.d(n,{Z:()=>r,a:()=>c});var a=t(7294);const i={},o=a.createContext(i);function c(e){const n=a.useContext(o);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),a.createElement(o.Provider,{value:n},e.children)}}}]);