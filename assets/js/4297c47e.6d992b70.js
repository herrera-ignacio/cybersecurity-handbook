"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[3558],{7129:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>a,default:()=>d,frontMatter:()=>r,metadata:()=>o,toc:()=>l});var i=n(5893),s=n(1151);const r={},a="MIME Sniffing",o={id:"vulnerabilities/web/mime-sniffing/README",title:"MIME Sniffing",description:"By confusing the MIME Sniffing Algorithm, browser can be manipulated into interpreting data in a way that allows an attacker to carry out operations that are not expected by either the site operator or user, such as Cross-Site Scripting.",source:"@site/docs/vulnerabilities/web/mime-sniffing/README.md",sourceDirName:"vulnerabilities/web/mime-sniffing",slug:"/vulnerabilities/web/mime-sniffing/",permalink:"/cybersecurity-handbook/vulnerabilities/web/mime-sniffing/",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Insufficient SPF record",permalink:"/cybersecurity-handbook/vulnerabilities/web/insuficient-spf/"},next:{title:"Null Terminator",permalink:"/cybersecurity-handbook/vulnerabilities/web/null-termination/"}},c={},l=[{value:"Charset Sniffing",id:"charset-sniffing",level:2},{value:"Cross-Site Scripting (XSS) with MIME Sniffing",id:"cross-site-scripting-xss-with-mime-sniffing",level:2},{value:"What if CSP is Present?",id:"what-if-csp-is-present",level:2},{value:"What Should Developers Do?",id:"what-should-developers-do",level:2}];function h(e){const t={blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.h1,{id:"mime-sniffing",children:"MIME Sniffing"}),"\n",(0,i.jsxs)(t.p,{children:["By confusing the MIME Sniffing Algorithm, browser can be manipulated into interpreting data in a way that allows an attacker to carry out operations that are not expected by either the site operator or user, such as ",(0,i.jsx)(t.strong,{children:"Cross-Site Scripting"}),"."]}),"\n",(0,i.jsx)(t.p,{children:"Moreover, by making sites which do not correctly assign MIME types to content appear to work correctly in those browsers, it fails to encourage the correct labelign of material, which in turn makes content sniffing necesary for these sites to work, reating a vicious circle of incompatibility with web standards and security best practices."}),"\n",(0,i.jsx)(t.h2,{id:"charset-sniffing",children:"Charset Sniffing"}),"\n",(0,i.jsxs)(t.p,{children:["Web Browsers attempt to determine the ",(0,i.jsx)(t.em,{children:"character encoding"})," of text files for whih the MIME type is already known. This technique is known as ",(0,i.jsx)(t.strong,{children:"Charset Sniffing"})," or ",(0,i.jsx)(t.strong,{children:"Codepage Sniffing"})," and for certain encodings, may be used to bypass security restrictions too."]}),"\n",(0,i.jsx)(t.p,{children:"For instance, IE7 may be tricked to run Javascript by allowing the browser to guess that an HTML-file was encoded UTF-7. This bug is worsened by the feature of the UTF-7 enconding which permits multiple encodings of the same text, ans specifically, alternative representations of ASCII characters."}),"\n",(0,i.jsx)(t.h2,{id:"cross-site-scripting-xss-with-mime-sniffing",children:"Cross-Site Scripting (XSS) with MIME Sniffing"}),"\n",(0,i.jsx)(t.p,{children:"Examples of Javascript and CSS parsing contxts relevant to MIME Sniffing are:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"<script>"})," tags"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"<link>"})," tags"]}),"\n"]}),"\n",(0,i.jsxs)(t.blockquote,{children:["\n",(0,i.jsx)(t.p,{children:"Note: Javascript execution via CSS Injection is an edge case and it is possible only for some browsers that support it."}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"For an attacker to perform an XSS attack by leveraging MIME sniffing, there are certain preconditions:"}),"\n",(0,i.jsx)(t.p,{children:"Client Side (both necessary for successful exploitation):"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Attacker should be able to control content in the server's response so that malicious Javascript can be injected."}),"\n",(0,i.jsx)(t.li,{children:"Attacker should be able to introduce an executable context via HTML Injection."}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"Server Side (only one necessary for successful exploitation):"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["If server misrepresents a resource, attack will be successful. For example, developer sets ",(0,i.jsx)(t.code,{children:"text/javascript"})," as ",(0,i.jsx)(t.code,{children:"Content-Type"})," header in a response containing text file."]}),"\n",(0,i.jsxs)(t.li,{children:['Server represents a resource correctly, however, browser\'s MIME sniffing mechanism makes the resource "executable". For example, developer sets ',(0,i.jsx)(t.code,{children:"text/plain"})," as ",(0,i.jsx)(t.code,{children:"Content-Type"})," header in a response containing text file. Although it is the correct MIME Type, browser performs MIME sniffing and makes it possible for an attacker to execute malicious Javascript from the text file."]}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"Once these preconditons are satisfied, attacker can use HTML Injection to inject executable context and then specify the soruce as the attacker-controlled resource."}),"\n",(0,i.jsx)(t.p,{children:"An example payload is as follows:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-html",children:'<script src="https://example.com/attacker_controlled_resource"><\/script>\n'})}),"\n",(0,i.jsxs)(t.p,{children:["Once this payload is encountered by browser, it may try to parse the response from ",(0,i.jsx)(t.code,{children:"example.com"})," as Javascript. As MIME Sniffing algorithms vary by browser, it is necessary to create a proof of concept to confirm behavior of a browser and exploitability of the vulnerability."]}),"\n",(0,i.jsx)(t.h2,{id:"what-if-csp-is-present",children:"What if CSP is Present?"}),"\n",(0,i.jsxs)(t.p,{children:["Let's assume that ",(0,i.jsx)(t.code,{children:"example.com"})," deploys a ",(0,i.jsx)(t.em,{children:"Content Security Policy (CSP)"})," that mitigates XSS exploits by disallowing scripts included from remote hosts."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"Content-Security-Policy: default-src \u2018self\u2019; img-src https://example.com; script-src https://example.com\n"})}),"\n",(0,i.jsxs)(t.p,{children:["In this case, an attacker cannot exploit an XSS vulnerability by using inline JavaScript or remotely hosted JavaScript because the payload will be blocked by CSP. However, attacker can make use of a resource hosted on ",(0,i.jsx)(t.code,{children:"example.com"})," and MIME Sniffnig to bypass CSP."]}),"\n",(0,i.jsxs)(t.p,{children:["Let's assume that an attacker can upload text files on ",(0,i.jsx)(t.code,{children:"example.com"}),". The attacker can write malicious JavaScript in a text file and specify the text file as the source of a script tag."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-html",children:'<script src="https://example.com/attacker.txt"><\/script>\n'})}),"\n",(0,i.jsxs)(t.p,{children:["Even if the server sets ",(0,i.jsx)(t.code,{children:"Content-Type"})," response header as ",(0,i.jsx)(t.code,{children:"text/plain"}),", a browser may MIME Sniff the response and parse the text file content as JavaScript. CSP will not mitigate an attack in this case because ",(0,i.jsx)(t.code,{children:"example.com"})," is a whitelisted domain."]}),"\n",(0,i.jsxs)(t.p,{children:["In the above scenarios, if the developer deploy the ",(0,i.jsx)(t.code,{children:"X-Content-Type-Options"})," header and specify the correct value of the ",(0,i.jsx)(t.code,{children:"Content-Type"})," response header, XSS attack will be mitigated."]}),"\n",(0,i.jsx)(t.h2,{id:"what-should-developers-do",children:"What Should Developers Do?"}),"\n",(0,i.jsxs)(t.p,{children:["Developers should always make sure that all resourecs served by a web application have correct ",(0,i.jsx)(t.code,{children:"Content-Type"})," header value in resposne. Also, the ",(0,i.jsx)(t.code,{children:"X-Content-Type-Options"})," header with ",(0,i.jsx)(t.code,{children:"nosniff"})," directive should be deployed for all application responses."]})]})}function d(e={}){const{wrapper:t}={...(0,s.a)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},1151:(e,t,n)=>{n.d(t,{Z:()=>o,a:()=>a});var i=n(7294);const s={},r=i.createContext(s);function a(e){const t=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),i.createElement(r.Provider,{value:t},e.children)}}}]);