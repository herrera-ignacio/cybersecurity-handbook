"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[988],{8291:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>a,metadata:()=>r,toc:()=>c});var t=i(5893),s=i(1151);const a={},l="SQL Injection",r={id:"vulnerabilities/web/sql-injection/README",title:"SQL Injection",description:"SQLi attack consists of injection of a SQL Query via the input data from the client to the application.",source:"@site/docs/vulnerabilities/web/sql-injection/README.md",sourceDirName:"vulnerabilities/web/sql-injection",slug:"/vulnerabilities/web/sql-injection/",permalink:"/cybersecurity-handbook/vulnerabilities/web/sql-injection/",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Path Traversal",permalink:"/cybersecurity-handbook/vulnerabilities/web/path-traversal/"},next:{title:"SQL Map Cheatsheet",permalink:"/cybersecurity-handbook/vulnerabilities/web/sql-injection/sql-map"}},o={},c=[{value:"Threat Modeling",id:"threat-modeling",level:2},{value:"How it works",id:"how-it-works",level:2},{value:"Data Exfiltration",id:"data-exfiltration",level:2},{value:"Examples",id:"examples",level:3},{value:"Example 1",id:"example-1",level:4},{value:"Example 2",id:"example-2",level:4},{value:"Mitigation",id:"mitigation",level:2},{value:"Types",id:"types",level:2},{value:"Blind SQLi",id:"blind-sqli",level:3},{value:"Union-Based injection",id:"union-based-injection",level:3},{value:"Error Based injection",id:"error-based-injection",level:3},{value:"Tools",id:"tools",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"sql-injection",children:"SQL Injection"}),"\n",(0,t.jsxs)(n.p,{children:["SQLi attack consists of ",(0,t.jsx)(n.strong,{children:"injection of a SQL Query via the input data from the client to the application"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"Successful SQLi explot can read sensitive data from database, modify it, execute administration operations (suh as shutdown the DBMS), recover the content of a given ifle present on the DBMS file system, and in some cases, issue commands to the operating system."}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://owasp.org/www-community/attacks/SQL_Injection",children:"OWASP: SQL Injection"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://sqlwiki.netspi.com/#mysql",children:"SQLWiki Netspi"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/OWASP/wstg/blob/master/document/4-Web_Application_Security_Testing/07-Input_Validation_Testing/05-Testing_for_SQL_Injection.md",children:"OWASP: Testing for SQLi"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://www.websec.ca/kb/sql_injection#MySQL_Testing_Injection",children:"SQL Injection Knowedge Base"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://stackoverflow.com/questions/332365/how-does-the-sql-injection-from-the-bobby-tables-xkcd-comic-work",children:"Bobby Tables XKCD"})}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"threat-modeling",children:"Threat Modeling"}),"\n",(0,t.jsx)(n.p,{children:"SQLi attacks allows attacerks to spoof identity, tamper with existing data, allow the complete disclosure of all data on the system, destroy data/make it unavailable, and become administrators of the database server."}),"\n",(0,t.jsx)(n.p,{children:"SQLi is very common with PHP and ASP applications due to the prevalence of older functional interaces."}),"\n",(0,t.jsx)(n.p,{children:"Severity of SQLi is limited by attacker's skill and imaginatino, and to a lesser extent, defense in depth countermeasures, such as low privilege connections to the database server and so on."}),"\n",(0,t.jsx)(n.p,{children:"In general, consider SQL injection a high impact severity."}),"\n",(0,t.jsx)(n.h2,{id:"how-it-works",children:"How it works"}),"\n",(0,t.jsx)(n.p,{children:"Essentially, the attack is accomplished by placing a meta characeter into data input to then place SQL ommands in the control plane, which did not exist there before."}),"\n",(0,t.jsx)(n.p,{children:"Some common payloads for a SELECT query are:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"' OR 1=1 --"})," (constant true)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"' AND 0=1 --"})," (constant false)"]}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://medium.com/@ismailtasdelen/sql-injection-payload-list-b97656cfd66b",children:"More common payloads"})}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"data-exfiltration",children:"Data Exfiltration"}),"\n",(0,t.jsx)(n.p,{children:"Exfiltrating data allows easier data analysis, as well as an offline copy of any compromised data."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://sqlwiki.netspi.com/attackQueries/dataExfiltration/#mysql",children:"Netspi's SQL Wiki: Exfiltrating methods"})}),"\n",(0,t.jsx)(n.h3,{id:"examples",children:"Examples"}),"\n",(0,t.jsx)(n.h4,{id:"example-1",children:"Example 1"}),"\n",(0,t.jsx)(n.p,{children:"SQL"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"select id, firstname, lastname from authors\n"})}),"\n",(0,t.jsx)(n.p,{children:"Input"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Firstname: evil'ex\nLastname: Newman\n"})}),"\n",(0,t.jsx)(n.p,{children:"Result Query"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"select id, firstname, lastname from authors where forename = 'evil'ex' and surname ='n\n"})}),"\n",(0,t.jsx)(n.p,{children:"Which database attempts to run:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Incorrect syntax near il' as the database tried to execute evil.\n"})}),"\n",(0,t.jsx)(n.h4,{id:"example-2",children:"Example 2"}),"\n",(0,t.jsx)(n.p,{children:"We construct a SQL query dynamically"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:' ...\n    string userName = ctx.getAuthenticatedUserName();\n    string query = "SELECT * FROM items WHERE owner = "\'"\n                    + userName + "\' AND itemname = \'"\n                    + ItemName.Text + "\'";\n    sda = new SqlDataAdapter(query, conn);\n    DataTable dt = new DataTable();\n    sda.Fill(dt);\n    ...\n'})}),"\n",(0,t.jsx)(n.p,{children:"This is intended to execute as follows"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"    SELECT * FROM items\n    WHERE owner =\n    AND itemname = ;\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Suppose we enter as ",(0,t.jsx)(n.code,{children:"itemname"})," the string ",(0,t.jsx)(n.code,{children:"\"name' OR 'a'='a\" "})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"    SELECT * FROM items\n    WHERE owner = 'wiley'\n    AND itemname = 'name' OR 'a'='a';\n"})}),"\n",(0,t.jsxs)(n.p,{children:["The addition of the ",(0,t.jsx)(n.code,{children:"OR 'a'='a'"})," condition causes the where clasue to evaluate to true, so the query becomes logically equivalent to:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"    SELECT * FROM items;\n"})}),"\n",(0,t.jsx)(n.p,{children:"This simplification allows the attacker to bypass the requiremnt that the query only return items owned by the authenticated user."}),"\n",(0,t.jsxs)(n.p,{children:["Even worst, suppose we enter as ",(0,t.jsx)(n.code,{children:"itenname"}),": ",(0,t.jsx)(n.code,{children:'"name\'); DELETE FROM items;--"'})]}),"\n",(0,t.jsx)(n.p,{children:"This now becomes"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"    SELECT * FROM items\n    WHERE owner = 'hacker'\n    AND itemname = 'name';\n\n    DELETE FROM items;\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Notice the trailing pair of hypens (",(0,t.jsx)(n.code,{children:"--"}),"). This specifies to most database ervers that the remainder of the statement is to be treated as a comment and not executed. In this case, it serves to remove te trailing single-quote left over from the modified query."]}),"\n",(0,t.jsxs)(n.p,{children:["In a database where comments are not allowed to be used in this way, the general attack could still be made effective using: ",(0,t.jsx)(n.code,{children:"\u201cname\u2019); DELETE FROM items; SELECT * FROM items WHERE \u2018a\u2019=\u2019a\u201d"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"mitigation",children:"Mitigation"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Handle SQLi attackas as an input validation problem","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Whitelist safe values"}),"\n",(0,t.jsx)(n.li,{children:"Identify and escape a blacklist of potentially malicious values"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:"Parameterized SQL statements"}),"\n",(0,t.jsx)(n.li,{children:"Use Stored Procedures (help limiting types of statements but they still fail to protect against many SQLi vulnerabilities)"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"types",children:"Types"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Blind SQLi","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Oracles (Partial Blind)"}),"\n",(0,t.jsx)(n.li,{children:"Truly Blind or Full Blind"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:"Union Based injection"}),"\n",(0,t.jsx)(n.li,{children:"Error Based injection"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"blind-sqli",children:"Blind SQLi"}),"\n",(0,t.jsx)(n.p,{children:"Your input is being inserted into a query, but you can't directly see the results of the query."}),"\n",(0,t.jsx)(n.p,{children:"For instance, a login page might contain bind SQLi, in that you can only get back whether or not a login has succeeded."}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Oracles"})," is when you're able to ",(0,t.jsx)(n.strong,{children:"get back a ginary condition"})," (success or failure)."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Truly blind"})," is when you see no difference whether the query failed or not."]}),"\n",(0,t.jsx)(n.h3,{id:"union-based-injection",children:"Union-Based injection"}),"\n",(0,t.jsxs)(n.p,{children:["Union-Based SQL injection allows an attacker to extract information from the database by extending the results returned by the original query. The ",(0,t.jsx)(n.code,{children:"UNION"})," keyword can be used to ",(0,t.jsx)(n.strong,{children:"retrieve data from other tables"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"The following SQL query will return a single result set with two columns. This implies that individual queries must return the same number of columns, and data types in each clumn ust be compatible with the individual queries."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-SQL",children:"SELECT a,b FROM table1 UNION SELECT c,d FROM table2\n"})}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"UNION"})," operator can only be used if the original/new queries have the same structure (nubmer and data type of columns)."]}),"\n",(0,t.jsxs)(n.p,{children:["This method can also be used to ",(0,t.jsx)(n.strong,{children:"extract database's server related information"})," such as database's users and credentials, table names, etc..."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.a,{href:"https://sqlwiki.netspi.com/injectionTypes/unionBased/#mysql",children:"Netspi's SQL Wiki - Union-Based injection"}),"\n",(0,t.jsx)(n.a,{href:"https://medium.com/@nyomanpradipta120/sql-injection-union-attack-9c10de1a5635",children:"SQLi Medium note about Union-Based Injection on MySQL"})]}),"\n",(0,t.jsx)(n.h3,{id:"error-based-injection",children:"Error Based injection"}),"\n",(0,t.jsx)(n.p,{children:"Error-Based injections are exploited through triggering errors in the database when invalid inputs are passed to it. The error messages can be used to return the full query results, or gain information on how to restructure the query for further exploitation."}),"\n",(0,t.jsx)(n.h2,{id:"tools",children:"Tools"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Burp Suite"}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/cybersecurity-handbook/vulnerabilities/web/sql-injection/sql-map",children:"SQL Map"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://www.youtube.com/watch?v=kuSS7Rd_e54",children:"SQL Map + Burp: Exploiting SQL Injection"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://www.youtube.com/watch?v=TjRK3aVEC60",children:"Blind SQLi attack, manually with Burp and Automatically with SQL Map"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},1151:(e,n,i)=>{i.d(n,{Z:()=>r,a:()=>l});var t=i(7294);const s={},a=t.createContext(s);function l(e){const n=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);